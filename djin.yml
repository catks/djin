djin_version: '0.10.0'

_default_run_options: &default_run_options
  options: "--rm --entrypoint=''"

tasks:
  test:
    description: Runs Specs
    docker-compose:
      service: app
      run:
        commands: "cd /usr/src/djin && rspec {{args}}"
        <<: *default_run_options
    aliases:
      - rspec

  sh:
    description: Enter app service shell
    docker-compose:
      service: app
      run:
        commands: "sh"
        <<: *default_run_options
  run:
    docker-compose:
      service: app
      run:
        commands: "sh -c '{{args}}'"
        <<: *default_run_options

  release:
    local:
      run:
        - verto tag up {{args}}
        - bundle exec rake release
